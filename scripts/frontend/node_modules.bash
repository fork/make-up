#!/bin/bash

# load helper
my_dir="$(dirname "$0")"
source "$my_dir/../../helper.bash"

echo
echo "  ${BLUE}TASK${NC} Node modules"
echo

ok=false

if [ ! -d "node_modules" ]; then
  # is it yarn?
  if [ -f "yarn.lock" ]; then
    echo
    echo "  ${BLUE}TASK${NC} Install node modules with yarn (yarn.lock exists)"
    echo

    yarn install
    ok=true
  fi

  # is it npm?
  if [ -f "package-lock.json" ]; then
    echo
    echo "  ${BLUE}TASK${NC} Install node modules with npm (package-lock.json exists)"
    echo

    npm install
    ok=true
  fi
fi

# try '$ npm start'
deploycommand=$(npm start --if-present)
if [ -n "$deploycommand" ]; then
  echo
  echo "  ${BLUE}TASK${NC} Run '$ npm start'"
  echo

  npm start

  ok=true
fi

# more-make-up
MORE_MAKE_UP="${0/make-up/more-make-up}"
if [ -f "$MORE_MAKE_UP" ]; then
  echo
  echo "  ${BLUE}TASK${NC} Run more Make-up from $MORE_MAKE_UP"
  echo

  $MORE_MAKE_UP

  echo
  echo "  ${GREEN}SUCCESS${NC} Done"
  echo

  ok=true
fi

if [ "$ok" = true ]; then
  echo
  echo "  ${GREEN}SUCCESS${NC} Done"
  echo
else
  echo
  echo "  ${RED}ERROR${NC} Could not find a method to execute command"
  echo
fi
