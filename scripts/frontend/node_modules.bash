#!/bin/bash

# load helper
my_dir="$(dirname "$0")"
source "$my_dir/../../helper.bash"

echo
echo "$I18N_TASK Node modules"
echo

ok=false

# install node_modules if they don't exist
if [ ! "$IDENT_NODE_MODULES" = true ]; then
  # is it yarn?
  if [ "$IDENT_YARN" = true ]; then
    echo
    echo "$I18N_TASK Install node modules with 'Yarn'"
    echo

    yarn install

    # test if installed
    if [ -d "node_modules" ]; then
      echo
      echo "$I18N_SUCCESS Done"
      echo
    else
      echo
      echo "$I18N_ERROR Could not install node modules"
      echo
    fi

    ok=true
  fi

  # is it npm?
  if [ "$IDENT_NPM" = true ]; then
    echo
    echo "$I18N_TASK Install node modules with 'npm'"
    echo

    npm install

    # test if installed
    if [ -d "node_modules" ]; then
      echo
      echo "$I18N_SUCCESS Done"
      echo
    else
      echo
      echo "$I18N_ERROR Could not install node modules"
      echo
    fi

    ok=true
  fi
else
  # node_modules are already installed
  ok=true
fi

# try task 'dev'
if grep -q \"dev\" "package.json"; then
  # is it yarn?
  if [ "$IDENT_YARN" = true ]; then
    echo
    echo "$I18N_TASK Run '$ yarn dev'"
    echo

    yarn dev
  fi

  # is it npm?
  if [ "$IDENT_NPM" = true ]; then
    echo
    echo "$I18N_TASK Run '$ npm run dev'"
    echo

    npm run dev
  fi

  ok=true
else
  # try task 'start'
  if grep -q \"start\" "package.json"; then
    # is it yarn?
    if [ "$IDENT_YARN" = true ]; then
      echo
      echo "$I18N_TASK Run '$ yarn start'"
      echo

      yarn start
    fi

    # is it npm?
    if [ "$IDENT_NPM" = true ]; then
      echo
      echo "$I18N_TASK Run '$ npm start'"
      echo

      npm start
    fi

    ok=true
  fi
fi

# more-make-up
MORE_MAKE_UP="${0/make-up/more-make-up}"
if [ -f "$MORE_MAKE_UP" ]; then
  echo
  echo "$I18N_TASK Run more Make-up from $MORE_MAKE_UP"
  echo

  $MORE_MAKE_UP

  echo
  echo "$I18N_SUCCESS Done"
  echo

  ok=true
fi

if [ "$ok" = true ]; then
  echo
  echo "$I18N_SUCCESS Done"
  echo
else
  echo
  echo "$I18N_ERROR Could not find a method to execute command"
  echo
fi
